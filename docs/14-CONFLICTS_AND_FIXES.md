# ğŸ”§ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¶Ø§Ø±Ø¨Ø§Øª ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª - Analysis Pack v2.1

> **Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 2.1.0  
> **ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** ÙŠÙ†Ø§ÙŠØ± 2026  
> **Ø§Ù„ØºØ±Ø¶:** ØªØ¯Ù‚ÙŠÙ‚ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¶Ø§Ø±Ø¨Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

---

## ğŸ“‹ Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ

ØªÙ… Ø§ÙƒØªØ´Ø§Ù **24 ØªØ¶Ø§Ø±Ø¨Ø§Ù‹/Ù†Ù‚ØµØ§Ù‹** ÙÙŠ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø©. Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙŠÙˆØ«Ù‚ ÙƒÙ„ Ù…Ù†Ù‡Ø§ Ù…Ø¹:
- Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ£Ø«Ø±
- Ø§Ù‚ØªØ¨Ø§Ø³ Ù‚ØµÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
- Ø³Ø¨Ø¨ Ø§Ù„ØªØ¶Ø§Ø±Ø¨
- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯

---

## ğŸš¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ¶Ø§Ø±Ø¨Ø§Øª

| ID | Ø§Ù„ÙØ¦Ø© | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ø®Ø·ÙˆØ±Ø© | Ø§Ù„Ø­Ø§Ù„Ø© |
|----|-------|-------|---------|--------|
| CF-01 | Runner | NEEDS_USER_ACTION=LOGIN vs social_public.noLogin=true | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­ |
| CF-02 | Runner | ØºÙŠØ§Ø¨ Execution Window Ø§Ù„Ù…Ù†ÙØµÙ„ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­ |
| CF-03 | Data Model | ØªÙƒØ±Ø§Ø± Ù…Ù„ÙØ§Øª Data Model (v1 Ùˆ v2) | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ ØªÙˆØ­ÙŠØ¯ |
| CF-04 | API | ØºÙŠØ§Ø¨ POST /auth/signup ÙÙŠ API Requirements | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-05 | Screens | ØºÙŠØ§Ø¨ Ø´Ø§Ø´Ø§Øª SaaS (Signup/Onboarding/Billing) | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-06 | User Flows | ØºÙŠØ§Ø¨ ØªØ¯ÙÙ‚Ø§Øª SaaS (Signup/Switch Tenant) | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-07 | Runner | ØºÙŠØ§Ø¨ MV3 Lifecycle/Reconnect strategy | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-08 | Runner | ØºÙŠØ§Ø¨ Offline Queue specs | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-09 | Evidence | ØºÙŠØ§Ø¨ PII Redaction rules | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-10 | UI Vendoring | ØºÙŠØ§Ø¨ CI check Ù„Ù„ØªØ²Ø§Ù…Ù† | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-11 | OpenAPI | Ù†Ù‚Øµ endpoints SaaS (signup/tenants/invites) | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-12 | Roadmap | ØªÙƒØ±Ø§Ø± Ù…Ù„ÙØ§Øª Roadmap (v1 Ùˆ v2) | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ ØªÙˆØ­ÙŠØ¯ |
| CF-13 | RBAC | ØºÙŠØ§Ø¨ Ù…Ù„Ù Ù…Ø³ØªÙ‚Ù„ Ù„Ù€ Permission Matrix | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ù†Ø´Ø§Ø¡ |
| CF-14 | Quotas | ØºÙŠØ§Ø¨ Ù…Ù„Ù Subscription/Quotas/Flags | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ù†Ø´Ø§Ø¡ |
| CF-15 | Runner | Ø§Ø³ØªØ®Ø¯Ø§Ù… <all_urls> Ø¶Ù…Ù†ÙŠ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© | ÙŠØ­ØªØ§Ø¬ ØªØµØ­ÙŠØ­ |
| CF-16 | API | ØºÙŠØ§Ø¨ X-Tenant-ID header ÙÙŠ Ø¨Ø¹Ø¶ endpoints | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ ØªÙˆØ­ÙŠØ¯ |
| CF-17 | Evidence | ØºÙŠØ§Ø¨ hash/timestamp ÙÙŠ Evidence schema | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-18 | Glossary | Ù…ØµØ·Ù„Ø­Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© (2 roles ÙÙ‚Ø·) | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ« |
| CF-19 | Screens | Ø´Ø§Ø´Ø© Company Ø¨Ø¯ÙˆÙ† Entity ÙÙŠ Data Model | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© | Ù…ÙˆØ«Ù‚ Ø³Ø§Ø¨Ù‚Ø§Ù‹ |
| CF-20 | Runner | ØºÙŠØ§Ø¨ size limits Ù„Ù„Ù€ Evidence | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-21 | API Mapping | Ù†Ù‚Øµ ÙÙŠ Audit Events Ù„Ù„Ù€ Extension | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© | ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© |
| CF-22 | DoD | ØºÙŠØ§Ø¨ Definition of Done Ù„Ù„Ù€ Sprints | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-23 | Runner | ØºÙŠØ§Ø¨ IndexedDB specs Ù„Ù„Ù€ Offline | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |
| CF-24 | Security | ØºÙŠØ§Ø¨ Extension-specific threats | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© | ÙŠØ­ØªØ§Ø¬ Ø¥Ø¶Ø§ÙØ© |

---

## ğŸ“ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª

---

### CF-01: NEEDS_USER_ACTION=LOGIN vs social_public.noLogin=true ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md` (Ø³Ø·Ø± 267): `actionType: 'CAPTCHA' | 'LOGIN' | 'VERIFICATION' | 'BLOCKED'`
- `11-EXTENSION_RUNNER_SPEC.md` (Ø³Ø·Ø± 607): `noLogin: true; // Never use user's session`

**Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³:**
```typescript
// Line 267
actionType: 'CAPTCHA' | 'LOGIN' | 'VERIFICATION' | 'BLOCKED';

// Line 607
constraints: {
  publicOnly: true;  // Never access private data
  noLogin: true;     // Never use user's session
};
```

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- Ø§Ù„Ù€ `NeedsUserActionMessage` ÙŠØ³Ù…Ø­ Ø¨Ù€ `LOGIN` ÙƒÙ€ actionType
- Ù„ÙƒÙ† `social_public` connector ÙŠØ­Ø¯Ø¯ `noLogin: true`
- Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù€ Runner Ù‚Ø¯ ÙŠØ·Ù„Ø¨ LOGIN Ù„Ù…ØµØ¯Ø± Ù…Ù…Ù†ÙˆØ¹ ÙÙŠÙ‡ LOGIN

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

// 1. ØªØ¹Ø¯ÙŠÙ„ NeedsUserActionMessage
interface NeedsUserActionMessage {
  type: 'NEEDS_USER_ACTION';
  payload: {
    jobId: string;
    stepId: number;
    // LOGIN Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ù„Ù„Ù€ connectors Ø§Ù„ØªÙŠ ØªØ³Ù…Ø­ Ø¨Ù‡
    actionType: 'CAPTCHA' | 'CONSENT' | 'VERIFICATION' | 'BLOCKED';
    message: string;
    tabId?: number;
  };
}

// 2. Ø¥Ø¶Ø§ÙØ© failure code Ø¬Ø¯ÙŠØ¯
failureModes: [
  'LOGIN_REQUIRED_UNSUPPORTED',  // Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ù…ØµØ¯Ø± ÙŠØªØ·Ù„Ø¨ login Ù„ÙƒÙ†Ù‡ Ù…Ù…Ù†ÙˆØ¹
  // ...
];

// 3. Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø¯Ø© ÙˆØ§Ø¶Ø­Ø©
/**
 * LOGIN Handling Rules:
 * - Ø¥Ø°Ø§ ÙƒØ§Ù† Connector.constraints.noLogin = true:
 *   - Ù„Ø§ ØªØ±Ø³Ù„ NEEDS_USER_ACTION Ù…Ø¹ actionType=LOGIN
 *   - Ø£Ø±Ø³Ù„ JOB_COMPLETE Ù…Ø¹ status=FAILED Ùˆ error.code=LOGIN_REQUIRED_UNSUPPORTED
 *   - Ø§ÙƒØªØ¨ Evidence Ø¨Ù€ "ØºÙŠØ± Ù…ØªØ§Ø­ - ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„"
 * - Ø¥Ø°Ø§ ÙƒØ§Ù† Connector.constraints.noLogin = false Ø£Ùˆ ØºÙŠØ± Ù…Ø­Ø¯Ø¯:
 *   - ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ NEEDS_USER_ACTION Ù…Ø¹ actionType=LOGIN
 */
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`
- ØªØ¹Ø¯ÙŠÙ„ `13-EXTENSION_API_MAPPING.md` Ù„Ø¥Ø¶Ø§ÙØ© error state

---

### CF-02: ØºÙŠØ§Ø¨ Execution Window Ø§Ù„Ù…Ù†ÙØµÙ„ ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md` (Ø³Ø·Ø± 101): ÙŠØ°ÙƒØ± "Opens dedicated tab" Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¶Ø­ Execution Window

**Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³:**
```
â”‚     â”œâ”€â”€â–º Opens dedicated tab (NOT user's tabs)
```

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- Ø§Ù„Ù…ØªØ·Ù„Ø¨ ÙŠÙ‚ÙˆÙ„: "Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙŠ Execution Window Ù…Ù†ÙØµÙ„ (minimized ØºØ§Ù„Ø¨Ù‹Ø§)"
- Ù„ÙƒÙ† Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ØªØ°ÙƒØ± "dedicated tab" ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªÙØ§ØµÙŠÙ„ Window

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

## ğŸªŸ Execution Window Architecture

### Ø§Ù„Ù…ÙÙ‡ÙˆÙ…
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXECUTION WINDOW ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ USER'S BROWSER (Normal Browsing)                                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [Tab 1: Gmail] [Tab 2: LinkedIn] [Tab 3: ...]                  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  âŒ Runner NEVER touches these tabs                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ EXECUTION WINDOW (Separate, Minimized)                           â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [Job Tab 1] [Job Tab 2] [Job Tab 3]                            â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  âœ… All job execution happens here                               â”‚   â”‚
â”‚  â”‚  âœ… User can continue browsing normally                          â”‚   â”‚
â”‚  â”‚  âœ… Window is minimized by default                               â”‚   â”‚
â”‚  â”‚  âœ… User can maximize to see/debug                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation
```typescript
interface ExecutionWindowManager {
  windowId: number | null;
  
  async ensureWindow(): Promise<number> {
    if (this.windowId) {
      // Check if window still exists
      try {
        await chrome.windows.get(this.windowId);
        return this.windowId;
      } catch {
        this.windowId = null;
      }
    }
    
    // Create new execution window
    const window = await chrome.windows.create({
      type: 'normal',
      state: 'minimized',  // Start minimized
      focused: false,
      width: 1200,
      height: 800
    });
    
    this.windowId = window.id!;
    return this.windowId;
  }
  
  async createJobTab(url: string): Promise<chrome.tabs.Tab> {
    const windowId = await this.ensureWindow();
    return chrome.tabs.create({
      windowId,
      url,
      active: false  // Don't steal focus
    });
  }
  
  async closeJobTab(tabId: number): Promise<void> {
    await chrome.tabs.remove(tabId);
  }
  
  async cleanup(): Promise<void> {
    if (this.windowId) {
      await chrome.windows.remove(this.windowId);
      this.windowId = null;
    }
  }
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-03: ØªÙƒØ±Ø§Ø± Ù…Ù„ÙØ§Øª Data Model (v1 Ùˆ v2) ğŸŸ 

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:**
- `02-DATA-MODEL.md` (v1 - 583 Ø³Ø·Ø±)
- `02-DATA-MODEL-V2.md` (v2 - 1168 Ø³Ø·Ø±)

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙÙŠÙ† Ø¨Ù†ÙØ³ Ø§Ù„ØºØ±Ø¶ ÙŠØ³Ø¨Ø¨ Ø§Ø±ØªØ¨Ø§Ùƒ
- v1 Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Multi-tenancy
- v2 ÙŠØ­ØªÙˆÙŠ Multi-tenancy Ù„ÙƒÙ† Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙƒØªÙ…Ù„

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```
1. Ø¯Ù…Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯: 02-DATA-MODEL.md
2. Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… "Legacy Schema (v1)" ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©
3. Ø­Ø°Ù 02-DATA-MODEL-V2.md
4. ØªØ­Ø¯ÙŠØ« README.md Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ­Ø¯
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `02-DATA-MODEL.md` (Ø¯Ù…Ø¬)
- Ø­Ø°Ù `02-DATA-MODEL-V2.md`
- ØªØ¹Ø¯ÙŠÙ„ `README.md`

---

### CF-04: ØºÙŠØ§Ø¨ POST /auth/signup ÙÙŠ API Requirements ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `06-API-REQUIREMENTS.md`: Ù„Ø§ ÙŠØ­ØªÙˆÙŠ endpoint Ù„Ù„ØªØ³Ø¬ÙŠÙ„

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- SaaS ÙŠØªØ·Ù„Ø¨ ØªØ¯ÙÙ‚ Signup Ù„Ø¥Ù†Ø´Ø§Ø¡ Tenant + Owner
- Ø§Ù„Ù€ API Requirements ÙŠØ¨Ø¯Ø£ Ù…Ù† Login ÙÙ‚Ø·

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```yaml
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ 06-API-REQUIREMENTS.md

### POST /api/auth/signup
Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Tenant

**Request:**
```json
{
  "email": "owner@company.com",
  "password": "SecurePass123!",
  "name": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  "companyName": "Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©",
  "companySlug": "tech-company",  // optional, auto-generated if not provided
  "phone": "+966501234567"  // optional
}
```

**Response (201):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "owner@company.com",
      "name": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"
    },
    "tenant": {
      "id": "uuid",
      "name": "Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©",
      "slug": "tech-company"
    },
    "token": "jwt-token",
    "refreshToken": "refresh-token"
  }
}
```

**Errors:**
- 400: VALIDATION_ERROR (email format, password strength)
- 409: EMAIL_ALREADY_EXISTS
- 409: SLUG_ALREADY_EXISTS

**Audit:** AUTH_SIGNUP
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `06-API-REQUIREMENTS.md`
- ØªØ¹Ø¯ÙŠÙ„ `openapi.yaml`

---

### CF-05: ØºÙŠØ§Ø¨ Ø´Ø§Ø´Ø§Øª SaaS (Signup/Onboarding/Billing) ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `03-SCREENS-ANALYSIS.md`: 17 Ø´Ø§Ø´Ø© ÙÙ‚Ø·ØŒ Ù„Ø§ ØªØ´Ù…Ù„ SaaS screens

**Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³:**
```markdown
| # | Ø§Ù„Ø´Ø§Ø´Ø© | Ø§Ù„Ù…Ù„Ù | Ø§Ù„Ù…Ø³Ø§Ø± | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© |
|---|--------|-------|--------|----------|
| 1 | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | `LoginPage.tsx` | `/login` | Ø¹Ø§Ù… |
...
| 17 | Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØµÙØ­ | `ExtensionSidePanel.tsx` | `/extension-preview` | Ø¹Ø§Ù… |
```

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- SaaS ÙŠØªØ·Ù„Ø¨ Ø´Ø§Ø´Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```markdown
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ 03-SCREENS-ANALYSIS.md

| 18 | Ø§Ù„ØªØ³Ø¬ÙŠÙ„ | `SignupPage.tsx` | `/signup` | Ø¹Ø§Ù… |
| 19 | Ø§Ù„ØªØ£Ù‡ÙŠÙ„ | `OnboardingPage.tsx` | `/onboarding` | Ù…Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ |
| 20 | ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© | `SwitchTenantPage.tsx` | `/switch-tenant` | Ù…Ø³Ø¬Ù„ |
| 21 | Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ | `BillingPage.tsx` | `/app/billing` | OWNER |
| 22 | Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… | `UsagePage.tsx` | `/app/usage` | ADMIN+ |
| 23 | Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† | `SecuritySettingsPage.tsx` | `/app/settings/security` | Ù…Ø³Ø¬Ù„ |
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `03-SCREENS-ANALYSIS.md`

---

### CF-06: ØºÙŠØ§Ø¨ ØªØ¯ÙÙ‚Ø§Øª SaaS (Signup/Switch Tenant) ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `04-USER-FLOWS.md`: 8 ØªØ¯ÙÙ‚Ø§Øª ÙÙ‚Ø·ØŒ Ù„Ø§ ØªØ´Ù…Ù„ SaaS flows

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- SaaS ÙŠØªØ·Ù„Ø¨ ØªØ¯ÙÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```markdown
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ 04-USER-FLOWS.md

## 9ï¸âƒ£ ØªØ¯ÙÙ‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Signup Flow)
## ğŸ”Ÿ ØªØ¯ÙÙ‚ Ø§Ù„ØªØ£Ù‡ÙŠÙ„ (Onboarding Flow)
## 1ï¸âƒ£1ï¸âƒ£ ØªØ¯ÙÙ‚ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© (Switch Tenant Flow)
## 1ï¸âƒ£2ï¸âƒ£ ØªØ¯ÙÙ‚ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª (Invite Flow)
## 1ï¸âƒ£3ï¸âƒ£ ØªØ¯ÙÙ‚ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Billing Flow)
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `04-USER-FLOWS.md`

---

### CF-07: ØºÙŠØ§Ø¨ MV3 Lifecycle/Reconnect strategy ğŸŸ 

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md`: ÙŠØ°ÙƒØ± WebSocket Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¶Ø­ MV3 service worker lifecycle

**Ù„Ù…Ø§Ø°Ø§ ØªØ¶Ø§Ø±Ø¨:**
- MV3 service workers ØªÙ†Ø§Ù… Ø¨Ø¹Ø¯ 30 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·
- WebSocket connection Ù‚Ø¯ ØªÙ†Ù‚Ø·Ø¹
- Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© reconnect Ù…ÙˆØ«Ù‚Ø©

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

## ğŸ”„ MV3 Lifecycle Management

### Service Worker Lifecycle
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MV3 SERVICE WORKER LIFECYCLE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     30s idle     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  ACTIVE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ SLEEPING â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚                             â”‚                                   â”‚
â”‚       â”‚ event/alarm                 â”‚ event/alarm                       â”‚
â”‚       â”‚                             â”‚                                   â”‚
â”‚       â–¼                             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    WAKE UP                                    â”‚      â”‚
â”‚  â”‚  1. Restore state from chrome.storage                        â”‚      â”‚
â”‚  â”‚  2. Reconnect WebSocket                                      â”‚      â”‚
â”‚  â”‚  3. Resume pending jobs                                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Keep-Alive Strategy
```typescript
// Use chrome.alarms to prevent sleeping during active jobs
chrome.alarms.create('keepAlive', { periodInMinutes: 0.4 }); // 24 seconds

chrome.alarms.onAlarm.addListener((alarm) => {
  if (alarm.name === 'keepAlive') {
    // Check for active jobs
    if (hasActiveJobs()) {
      // Send heartbeat to keep connection alive
      sendHeartbeat();
    } else {
      // No active jobs, allow sleep
      chrome.alarms.clear('keepAlive');
    }
  }
});
```

### WebSocket Reconnect Strategy
```typescript
class WebSocketManager {
  private ws: WebSocket | null = null;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;
  private reconnectDelay = 1000; // Start with 1s, exponential backoff
  
  async connect(): Promise<void> {
    // ... connection logic
  }
  
  private scheduleReconnect(): void {
    const delay = Math.min(
      this.reconnectDelay * Math.pow(2, this.reconnectAttempts),
      30000 // Max 30 seconds
    );
    
    setTimeout(() => this.connect(), delay);
    this.reconnectAttempts++;
  }
  
  private onClose(): void {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.scheduleReconnect();
    } else {
      // Notify user, pause jobs
      this.notifyConnectionLost();
    }
  }
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-08: ØºÙŠØ§Ø¨ Offline Queue specs ğŸŸ 

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md` (Ø³Ø·Ø± 64): ÙŠØ°ÙƒØ± "Offline Queue" Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† ØªÙØ§ØµÙŠÙ„

**Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³:**
```
| **Offline Queue** | ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Ø¹Ù†Ø¯ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ |
```

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

## ğŸ“´ Offline Queue (IndexedDB)

### Schema
```typescript
interface OfflineQueueItem {
  id: string;
  type: 'EVIDENCE' | 'LOG' | 'PROGRESS' | 'JOB_COMPLETE';
  payload: object;
  createdAt: number;
  retryCount: number;
  maxRetries: number;
}

// IndexedDB Store
const DB_NAME = 'leedz-offline';
const STORE_NAME = 'queue';
const MAX_QUEUE_SIZE = 100;  // Max items
const MAX_ITEM_AGE = 24 * 60 * 60 * 1000;  // 24 hours
```

### Limits
| Limit | Value | Reason |
|-------|-------|--------|
| Max queue size | 100 items | Prevent storage bloat |
| Max item age | 24 hours | Stale data not useful |
| Max item size | 100KB | Prevent large payloads |
| Max retries | 3 | Avoid infinite loops |

### Sync Strategy
```typescript
async function syncOfflineQueue(): Promise<void> {
  const items = await getQueuedItems();
  
  for (const item of items) {
    try {
      await sendToBackend(item);
      await removeFromQueue(item.id);
    } catch (error) {
      if (item.retryCount >= item.maxRetries) {
        await removeFromQueue(item.id);
        console.error('Dropped item after max retries:', item.id);
      } else {
        await incrementRetryCount(item.id);
      }
    }
  }
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-09: ØºÙŠØ§Ø¨ PII Redaction rules ğŸŸ 

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md`: ÙŠØ°ÙƒØ± sanitization Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† Ù‚ÙˆØ§Ø¹Ø¯ PII

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

## ğŸ” PII Redaction Rules

### What to Redact
| PII Type | Pattern | Replacement |
|----------|---------|-------------|
| Credit Card | `\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}` | `[CARD_REDACTED]` |
| SSN/National ID | `\d{10}` (Saudi) | `[ID_REDACTED]` |
| Password fields | `password=.*` | `[PASSWORD_REDACTED]` |
| API Keys | `(api[_-]?key|token)[:=]\s*\S+` | `[KEY_REDACTED]` |

### What NOT to Redact (Business Data)
- Phone numbers (business contact)
- Email addresses (business contact)
- Company names
- Employee names (public profiles)
- Addresses (business locations)

### Implementation
```typescript
function sanitizeEvidence(text: string): string {
  const patterns = [
    { regex: /\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}/g, replacement: '[CARD_REDACTED]' },
    { regex: /\b\d{10}\b/g, replacement: '[ID_REDACTED]' },
    { regex: /password[:=]\s*\S+/gi, replacement: '[PASSWORD_REDACTED]' },
    { regex: /(api[_-]?key|secret|token)[:=]\s*\S+/gi, replacement: '[KEY_REDACTED]' },
  ];
  
  let sanitized = text;
  for (const { regex, replacement } of patterns) {
    sanitized = sanitized.replace(regex, replacement);
  }
  
  return sanitized;
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-10: ØºÙŠØ§Ø¨ CI check Ù„Ù„ØªØ²Ø§Ù…Ù† ğŸŸ¡

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `12-UI_VENDORIZING_PLAN.md`: ÙŠØ°ÙƒØ± vendoring script Ù„ÙƒÙ† Ø¨Ø¯ÙˆÙ† CI check

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```yaml
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ 12-UI_VENDORIZING_PLAN.md

## ğŸ”„ CI Sync Check

### GitHub Action
```yaml
# .github/workflows/extension-ui-sync.yml
name: Extension UI Sync Check

on:
  push:
    paths:
      - 'web/src/components/**'
      - 'web/src/pages/ExtensionSidePanel.tsx'
      - 'extension/src/ui/**'

jobs:
  check-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run vendor script
        run: node scripts/vendor-ui.js --check-only
        
      - name: Fail if out of sync
        run: |
          if [ -f .ui-out-of-sync ]; then
            echo "âŒ Extension UI is out of sync with Web UI"
            echo "Run: npm run vendor-ui"
            exit 1
          fi
```

### Check-only Mode
```javascript
// scripts/vendor-ui.js --check-only
if (process.argv.includes('--check-only')) {
  const diffs = compareFiles(WEB_FILES, EXTENSION_FILES);
  if (diffs.length > 0) {
    fs.writeFileSync('.ui-out-of-sync', diffs.join('\n'));
    process.exit(1);
  }
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `12-UI_VENDORIZING_PLAN.md`

---

### CF-11: Ù†Ù‚Øµ endpoints SaaS ÙÙŠ OpenAPI ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `openapi.yaml`: Ù„Ø§ ÙŠØ­ØªÙˆÙŠ endpoints ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù€ SaaS

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```yaml
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ openapi.yaml

paths:
  /api/auth/signup:
    post:
      tags: [Auth]
      summary: Create new account with tenant
      # ...
      
  /api/tenants:
    get:
      tags: [Tenants]
      summary: List user's tenants
      # ...
    post:
      tags: [Tenants]
      summary: Create new tenant
      # ...
      
  /api/tenants/{id}/switch:
    post:
      tags: [Tenants]
      summary: Switch to tenant
      # ...
      
  /api/invites:
    get:
      tags: [Team]
      summary: List pending invites
      # ...
    post:
      tags: [Team]
      summary: Create invite
      # ...
      
  /api/invites/{token}/accept:
    post:
      tags: [Team]
      summary: Accept invite
      # ...
      
  /api/billing/plan:
    get:
      tags: [Billing]
      summary: Get current plan
      # ...
      
  /api/billing/usage:
    get:
      tags: [Billing]
      summary: Get usage stats
      # ...
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `openapi.yaml`

---

### CF-15: Ø§Ø³ØªØ®Ø¯Ø§Ù… <all_urls> Ø¶Ù…Ù†ÙŠ ğŸ”´

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md`: ÙŠØ°ÙƒØ± allowlist Ù„ÙƒÙ† manifest example Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØºÙŠØ± ÙˆØ§Ø¶Ø­

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```json
// ØªØ£ÙƒÙŠØ¯ ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

// âŒ NEVER use
"host_permissions": ["<all_urls>"]

// âœ… ALWAYS use explicit allowlist
"host_permissions": [
  "https://www.google.com/maps/*",
  "https://maps.google.com/*",
  "https://www.google.com/search*",
  "https://www.linkedin.com/company/*",
  "https://www.linkedin.com/in/*",
  "https://api.leadz.sa/*"
]

// âŒ NEVER add dynamically without review
// Any new domain requires:
// 1. Security review
// 2. Privacy impact assessment
// 3. Manifest update + Chrome Web Store review
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-17: ØºÙŠØ§Ø¨ hash/timestamp ÙÙŠ Evidence schema ğŸŸ¡

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md` (Ø³Ø·Ø± 252-260): EvidenceItem Ø¨Ø¯ÙˆÙ† hash

**Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³:**
```typescript
interface EvidenceItem {
  type: EvidenceType;
  title: string;
  source: string;
  url?: string;
  snippet: string;
  confidence: 'HIGH' | 'MEDIUM' | 'LOW';
  rawData?: object;
}
```

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
interface EvidenceItem {
  type: EvidenceType;
  title: string;
  source: string;
  url?: string;
  snippet: string;
  confidence: 'HIGH' | 'MEDIUM' | 'LOW';
  rawData?: object;
  
  // Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
  hash: string;           // SHA-256 of snippet for deduplication
  collectedAt: string;    // ISO timestamp
  pageLoadTime?: number;  // ms, for debugging
  sizeBytes: number;      // For quota tracking
}
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`
- ØªØ¹Ø¯ÙŠÙ„ `02-DATA-MODEL.md` (evidence table)

---

### CF-20: ØºÙŠØ§Ø¨ size limits Ù„Ù„Ù€ Evidence ğŸŸ 

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `11-EXTENSION_RUNNER_SPEC.md`: Ù„Ø§ ÙŠØ­Ø¯Ø¯ Ø­Ø¯ÙˆØ¯ Ø­Ø¬Ù… Evidence

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```typescript
// Ø¥Ø¶Ø§ÙØ© ÙÙŠ 11-EXTENSION_RUNNER_SPEC.md

## ğŸ“ Evidence Size Limits

| Limit | Value | Reason |
|-------|-------|--------|
| Max snippet length | 10,000 chars | Prevent huge text blocks |
| Max rawData size | 50KB | Prevent large JSON |
| Max evidence per job | 100 items | Prevent abuse |
| Max total per job | 5MB | Network/storage limits |

### Enforcement
```typescript
function validateEvidence(item: EvidenceItem): EvidenceItem {
  return {
    ...item,
    snippet: item.snippet.slice(0, 10000),
    rawData: truncateObject(item.rawData, 50 * 1024),
    sizeBytes: calculateSize(item)
  };
}
```
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `11-EXTENSION_RUNNER_SPEC.md`

---

### CF-22: ØºÙŠØ§Ø¨ Definition of Done Ù„Ù„Ù€ Sprints ğŸŸ 

**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ£Ø«Ø±:**
- `07-DEVELOPMENT-ROADMAP.md`: Ù„Ø§ ÙŠØ­ØªÙˆÙŠ DoD ÙˆØ§Ø¶Ø­

**Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:**
```markdown
# Ø¥Ø¶Ø§ÙØ© ÙÙŠ 07-DEVELOPMENT-ROADMAP.md

## âœ… Definition of Done (DoD)

### Sprint: SaaS Foundation
- [ ] All endpoints return tenant-scoped data
- [ ] RBAC enforced on all protected routes
- [ ] Signup flow creates tenant + owner
- [ ] Invite flow works end-to-end
- [ ] Switch tenant works for multi-tenant users
- [ ] Unit tests: 80% coverage on auth/tenant modules
- [ ] Integration tests: signup, login, invite, switch
- [ ] Security review: no tenant data leakage

### Sprint: Runner Core
- [ ] Extension connects to backend via WebSocket
- [ ] Job dispatch and ACK work
- [ ] Progress updates flow correctly
- [ ] Evidence upload works
- [ ] Execution Window opens minimized
- [ ] User tabs are never touched
- [ ] MV3 lifecycle handled (sleep/wake)
- [ ] Offline queue works for 100 items
- [ ] No <all_urls> in manifest
- [ ] Chrome Web Store review passed
```

**Ø§Ù„Ø£Ø«Ø±:**
- ØªØ¹Ø¯ÙŠÙ„ `07-DEVELOPMENT-ROADMAP.md`

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

| Ø§Ù„Ù…Ù„Ù | Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
|-------|---------------|----------|
| `11-EXTENSION_RUNNER_SPEC.md` | 8 | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| `06-API-REQUIREMENTS.md` | 3 | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| `openapi.yaml` | 2 | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| `03-SCREENS-ANALYSIS.md` | 1 | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| `04-USER-FLOWS.md` | 1 | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| `02-DATA-MODEL.md` | 2 | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© |
| `07-DEVELOPMENT-ROADMAP.md` | 2 | ğŸŸ  Ù…ØªÙˆØ³Ø·Ø© |
| `12-UI_VENDORIZING_PLAN.md` | 1 | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© |
| `13-EXTENSION_API_MAPPING.md` | 1 | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© |
| `00-GLOSSARY.md` | 1 | ğŸŸ¡ Ù…Ù†Ø®ÙØ¶Ø© |

---

## â“ Open Questions

| # | Ø§Ù„Ø³Ø¤Ø§Ù„ | Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­Ù‚Ù‚ |
|---|--------|--------------|
| 1 | Ù‡Ù„ Ù†Ø³Ù…Ø­ Ø¨Ù€ LOGIN Ù„Ø£ÙŠ connectorØŸ | Product decision |
| 2 | Ù…Ø§ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Offline QueueØŸ | Performance testing |
| 3 | Ù‡Ù„ Ù†Ø­ØªØ§Ø¬ redact Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ | Legal review |
| 4 | Ù…Ø§ Ù…Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ© Evidence Ø§Ù„Ù‚Ø¯ÙŠÙ…ØŸ | Product decision |

---

> **Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:** [15-MULTITENANCY_RBAC_MATRIX.md](./15-MULTITENANCY_RBAC_MATRIX.md)
