# ุงููุฑุญูุฉ 1: ุชุญุณูู Google Maps Search

> ุขุฎุฑ ุชุญุฏูุซ: 2026-01-08
> **ุงูุญุงูุฉ: โ ููุชูู**

---

## ๐ฏ ุงููุฏู

ุชุญุณูู ุฌูุฏุฉ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู Google Maps ูุชุญููู:
- ุงุณุชุฎุฑุงุฌ 90%+ ูู ุฃุฑูุงู ุงูููุงุชู
- ุงุณุชุฎุฑุงุฌ 95%+ ูู ุงูููุงูุน ุงูุฅููุชุฑูููุฉ
- ุงุณุชุฎุฑุงุฌ ุงูุนูุงููู ุงููุงููุฉ
- ููุช ุจุญุซ < 30 ุซุงููุฉ ูู 30 ูุชูุฌุฉ

---

## โ ุงูุชุญุณููุงุช ุงููููุฐุฉ

### 1. ุฅูุดุงุก ูููุงุช lib/ ุงูุฌุฏูุฏุฉ
- `extension/lib/selectors.js` - ููู selectors ูุญุณู ูุน fallbacks ูุชุนุฏุฏุฉ
- `extension/lib/utils.js` - ุฏูุงู ูุณุงุนุฏุฉ ููุฃุฏุงุก ูุงูุชุญูู

### 2. ุชุญุณูู extractPlaceDetails()
- ุฅุถุงูุฉ **9 selectors ูููุงุชู** ูุน fallbacks
- ุฅุถุงูุฉ **7 selectors ูููููุน** ูุน fallbacks
- ุฅุถุงูุฉ **7 selectors ููุนููุงู** ูุน fallbacks
- **3 ุงุณุชุฑุงุชูุฌูุงุช** ูุงุณุชุฎุฑุงุฌ ูู ููุน ุจูุงูุงุช
- ุงุณุชุฎุฑุงุฌ **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ูููุฒุฉ ุฅุถุงููุฉ
- ุงุณุชุฎุฑุงุฌ **ุณุงุนุงุช ุงูุนูู**

### 3. ุชุญุณูู extractGoogleMapsResults()
- **4 ุงุณุชุฑุงุชูุฌูุงุช ุงุณุชุฎุฑุงุฌ** ูุชุณูุณูุฉ:
  1. Place Links (ุงูุฃูุซุฑ ููุซูููุฉ)
  2. Feed Items
  3. Single Place View
  4. Article Elements
- ุฏูุงู ูุณุงุนุฏุฉ ูุญุณูุฉ ููุชูููู ูุงููุฑุงุฌุนุงุช ูุงูุนููุงู
- ุฎูุงุฑุฒููุฉ **Match Score** ูุญุณูุฉ ููุจุญุซ ุงููุฑุฏู

### 4. ุฅุถุงูุฉ Retry Logic ูุชุญุณูู ุงูุฃุฏุงุก
- **withRetry()** - ุฏุงูุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุน ุชุฃุฎูุฑ ุชุตุงุนุฏู
- **waitForResults()** - ุงุณุชุฎุฏุงู MutationObserver ุจุฏูุงู ูู setTimeout
- **Enrichment** ูููุชุงุฆุฌ ุงูููููุฉ (โค5) ุจุงุณุชุฎุฑุงุฌ ุงูุชูุงุตูู
- ุชูููู ุฃููุงุช ุงูุงูุชุธุงุฑ ุงูุซุงุจุชุฉ

---

## ๐ ุงูุชุญููู ุงูุณุงุจู (ูููุฑุฌุนูุฉ)

### ููุงุท ุงูููุฉ โ
- ุงูุจุญุซ ูุนูู ูููุชุญ Google Maps
- ุงุณุชุฎุฑุงุฌ ุงูุฃุณูุงุก ูุนูู ุจุดูู ุฌูุฏ
- ุญูุธ ุงููุชุงุฆุฌ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนูู
- ูุธุงู ุงูู Jobs ูุนูู ุจุดูู ุตุญูุญ

### ููุงุท ุงูุถุนู โ๏ธ (ุชู ูุนุงูุฌุชูุง)
- ~~ุงุณุชุฎุฑุงุฌ ุงููุงุชู ุถุนูู~~ โ ูุญุณู
- ~~ุงุณุชุฎุฑุงุฌ ุงููููุน ุงูุฅููุชุฑููู ุบูุฑ ููุชูู~~ โ ูุญุณู
- ~~ูุง ูุณุชุฎุฑุฌ ุณุงุนุงุช ุงูุนูู~~ โ ูุถุงู
- ~~Selectors ูุฏ ุชุชุบูุฑ~~ โ fallbacks ูุชุนุฏุฏุฉ

---

## ๐ง ุงูุชุญุณููุงุช ุงููุทููุจุฉ

### 1. ุชุญุณูู extractPlaceDetails()

**ุงูููู**: `extension/background.js`
**ุงูุณุทูุฑ**: 1002-1150

#### ุงูุชุญุณููุงุช:

```javascript
// ุฅุถุงูุฉ selectors ูุชุนุฏุฏุฉ ูููุงุชู
const phoneSelectors = [
  'button[data-item-id*="phone"]',
  'a[data-item-id*="phone"]',
  '[aria-label*="Phone"]',
  '[aria-label*="ูุงุชู"]',
  'button[data-tooltip*="phone"]',
  'a[href^="tel:"]',
];

// ุฅุถุงูุฉ selectors ูุชุนุฏุฏุฉ ูููููุน
const websiteSelectors = [
  'a[data-item-id*="authority"]',
  'a[data-item-id*="website"]',
  '[aria-label*="Website"]',
  '[aria-label*="ูููุน"]',
  'a[href]:not([href*="google"])',
];

// ุฅุถุงูุฉ selectors ููุนููุงู
const addressSelectors = [
  'button[data-item-id*="address"]',
  '[aria-label*="Address"]',
  '[aria-label*="ุนููุงู"]',
  '.rogA2c',
  '.Io6YTe',
];
```

### 2. ุชุญุณูู extractGoogleMapsResults()

**ุงูููู**: `extension/background.js`
**ุงูุณุทูุฑ**: 1211-1398

#### ุงูุชุญุณููุงุช:

```javascript
// ุงุณุชุฎุฏุงู ุงุณุชุฑุงุชูุฌูุงุช ูุชุนุฏุฏุฉ ููุงุณุชุฎุฑุงุฌ
const extractionStrategies = [
  extractFromPlaceLinks,      // ุงูุฃูุซุฑ ููุซูููุฉ
  extractFromFeedItems,       // ุจุฏูู
  extractFromArticles,        // ุจุฏูู ุซุงูู
  extractFromSinglePlace,     // ููุตูุญุฉ ุงููุฑุฏูุฉ
];

// ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุชูููู
function extractRating(container) {
  const selectors = [
    'span.MW4etd',
    'span[aria-hidden="true"]',
    '.F7nice span',
  ];
  // ...
}

// ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุนุฏุฏ ุงููุฑุงุฌุนุงุช
function extractReviews(container) {
  const patterns = [
    /\((\d[\d,\.]*)\)/,
    /(\d[\d,\.]*)\s*reviews?/i,
    /(\d[\d,\.]*)\s*ูุฑุงุฌุน/,
  ];
  // ...
}
```

### 3. ุฅุถุงูุฉ Retry Logic

```javascript
async function searchWithRetry(params, maxRetries = 3) {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await searchGoogleMaps(params);
    } catch (error) {
      console.error(`[Leedz] Attempt ${attempt} failed:`, error.message);
      if (attempt === maxRetries) throw error;
      await delay(2000 * attempt); // ุชุฃุฎูุฑ ุชุตุงุนุฏู
    }
  }
}
```

### 4. ุชุญุณูู ุงูุฃุฏุงุก

```javascript
// ุชูููู ููุช ุงูุงูุชุธุงุฑ ุงูุซุงุจุช
const WAIT_TIMES = {
  pageLoad: 3000,      // ุจุฏูุงู ูู 5000
  scrollDelay: 1000,   // ุจุฏูุงู ูู 1500
  detailsLoad: 2000,   // ุจุฏูุงู ูู 3000
};

// ุงุณุชุฎุฏุงู MutationObserver ุจุฏูุงู ูู setTimeout
async function waitForResults(tabId, timeout = 10000) {
  return chrome.scripting.executeScript({
    target: { tabId },
    func: (timeout) => {
      return new Promise((resolve) => {
        const observer = new MutationObserver((mutations, obs) => {
          const results = document.querySelectorAll('a[href*="/maps/place/"]');
          if (results.length > 0) {
            obs.disconnect();
            resolve(results.length);
          }
        });
        observer.observe(document.body, { childList: true, subtree: true });
        setTimeout(() => {
          observer.disconnect();
          resolve(0);
        }, timeout);
      });
    },
    args: [timeout],
  });
}
```

---

## ๐ ุงููููุงุช ุงููุชุฃุซุฑุฉ

| ุงูููู | ุงูุชุบููุฑุงุช |
|-------|-----------|
| `extension/background.js` | ุชุญุณูู extractPlaceDetails, extractGoogleMapsResults |
| `extension/lib/selectors.js` | ๐ ููู ุฌุฏูุฏ ููู selectors |
| `extension/lib/utils.js` | ๐ ุฏูุงู ูุณุงุนุฏุฉ |

---

## โ ูุงุฆูุฉ ุงูููุงู

### ุงูุชุญุถูุฑ
- [ ] ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู background.js
- [ ] ุฅูุดุงุก ูุฌูุฏ lib/
- [ ] ุฅูุดุงุก ููู selectors.js

### ุงูุชูููุฐ
- [ ] ุชุญุณูู extractPlaceDetails()
  - [ ] ุฅุถุงูุฉ selectors ูุชุนุฏุฏุฉ ูููุงุชู
  - [ ] ุฅุถุงูุฉ selectors ูุชุนุฏุฏุฉ ูููููุน
  - [ ] ุฅุถุงูุฉ selectors ููุนููุงู
  - [ ] ุฅุถุงูุฉ ุงุณุชุฎุฑุงุฌ ุณุงุนุงุช ุงูุนูู
- [ ] ุชุญุณูู extractGoogleMapsResults()
  - [ ] ุฅุถุงูุฉ ุงุณุชุฑุงุชูุฌูุงุช ุงุณุชุฎุฑุงุฌ ูุชุนุฏุฏุฉ
  - [ ] ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุชูููู
  - [ ] ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงููุฑุงุฌุนุงุช
- [ ] ุฅุถุงูุฉ Retry Logic
- [ ] ุชุญุณูู ุงูุฃุฏุงุก
  - [ ] ุชูููู ุฃููุงุช ุงูุงูุชุธุงุฑ
  - [ ] ุงุณุชุฎุฏุงู MutationObserver

### ุงูุงุฎุชุจุงุฑ
- [ ] ุงุฎุชุจุงุฑ ุงูุจุญุซ ุงููุฑุฏู (10 ุญุงูุงุช)
- [ ] ุงุฎุชุจุงุฑ ุงูุจุญุซ ุงูุฌูุงุนู (5 ุญุงูุงุช)
- [ ] ููุงุณ ูุณุจุฉ ุงุณุชุฎุฑุงุฌ ุงูููุงุชู
- [ ] ููุงุณ ูุณุจุฉ ุงุณุชุฎุฑุงุฌ ุงูููุงูุน
- [ ] ููุงุณ ููุช ุงูุจุญุซ

---

## ๐งช ุญุงูุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุจุญุซ ุงููุฑุฏู
| ุงูุงุณู | ุงููุฏููุฉ | ุงููุชูุฌุฉ ุงููุชููุนุฉ |
|-------|---------|------------------|
| ุดุฑูุฉ ุงูุฑุงุฌุญู | ุงูุฑูุงุถ | ูุชูุฌุฉ ูุงุญุฏุฉ ูุน ุชูุงุตูู |
| ูุทุนู ุงูุจูู | ุฌุฏุฉ | ูุชูุฌุฉ ูุงุญุฏุฉ ูุน ุชูุงุตูู |
| ููุฏู ุงูููุตููุฉ | ุงูุฑูุงุถ | ูุชูุฌุฉ ูุงุญุฏุฉ ูุน ุชูุงุตูู |

### ุงูุจุญุซ ุงูุฌูุงุนู
| ุงููุดุงุท | ุงููุฏููุฉ | ุงูุนุฏุฏ | ุงููุชูุฌุฉ ุงููุชููุนุฉ |
|--------|---------|-------|------------------|
| ูุทุงุนู | ุงูุฑูุงุถ | 30 | 25-30 ูุชูุฌุฉ |
| ููุงุฏู | ุฌุฏุฉ | 20 | 15-20 ูุชูุฌุฉ |
| ูุณุชุดููุงุช | ุงูุฏูุงู | 10 | 8-10 ูุชุงุฆุฌ |

---

## ๐ ูุนุงููุฑ ุงููุฌุงุญ

| ุงููุนูุงุฑ | ุงููุฏู | ุงูุญุฏ ุงูุฃุฏูู |
|---------|-------|-------------|
| ุงุณุชุฎุฑุงุฌ ุงููุงุชู | 90% | 80% |
| ุงุณุชุฎุฑุงุฌ ุงููููุน | 95% | 85% |
| ุงุณุชุฎุฑุงุฌ ุงูุนููุงู | 95% | 90% |
| ููุช ุงูุจุญุซ (30 ูุชูุฌุฉ) | < 30 ุซุงููุฉ | < 45 ุซุงููุฉ |
| ูุณุจุฉ ุงููุฌุงุญ | 98% | 95% |

---

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูููู 1
1. ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
2. ุฅูุดุงุก ูููุงุช lib/
3. ุชุญุณูู extractPlaceDetails()

### ุงูููู 2
1. ุชุญุณูู extractGoogleMapsResults()
2. ุฅุถุงูุฉ Retry Logic
3. ุงุฎุชุจุงุฑ ุฃููู

### ุงูููู 3
1. ุชุญุณูู ุงูุฃุฏุงุก
2. ุงุฎุชุจุงุฑ ุดุงูู
3. ููุงุณ ุงููุนุงููุฑ
4. ุฅุตูุงุญ ุฃู ูุดุงูู
